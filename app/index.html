<!DOCTYPE html>
<html lang="it" ng-app>
    <head>
        <meta charset="utf-8">
        <meta name="Description" content="">
        <title>IoT Dashboard - Powered by GDG Brescia & T4SM</title>
        <link rel="stylesheet" href="css/bootstrap.min.css" >
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css" >
        <link rel="stylesheet" href="css/font-awesome.css" >
        <link rel="stylesheet" href="css/iot.css" >
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
                position: relative;
                z-index: 0;
            }
            #iot-canvas{
                width: 800px;
                height: 300px;
                border: 1px inset #333;
            }

        </style>

        <script type="text/javascript" src="lib/jquery-1.9.0.min.js"></script>
        <script type="text/javascript" src="lib/bootstrap/bootstrap.js"></script>
        <script type="text/javascript">
            var libScctPath="/app/lib/libscct";
            var libGeminiSocketPath="/app/lib/libscct/libgeminisocket";
        </script>
        <script type="text/javascript" src="lib/libscct/libscct.js"></script>        
        <script type="text/javascript" src="js/app.js"></script> 
        <script type="text/javascript" src="js/scctinterface.js"></script> 
        <!--Load the GOOGLE AJAX API-->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            
            // Load the Visualization API and the piechart package.
            google.load('visualization', '1.0', {'packages':['corechart']});

            // Set a callback to run when the Google Visualization API is loaded.
            google.setOnLoadCallback(drawChart);

            // Callback that creates and populates a data table,
            // instantiates the pie chart, passes in the data and
            // draws it.
            function drawChart() {
                // Create the data table.
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Topping');
                data.addColumn('number', 'Slices');
                data.addRows([
                    ['Mushrooms', 3],
                    ['Onions', 1],
                    ['Olives', 1],
                    ['Zucchini', 1],
                    ['Pepperoni', 2]
                ]);
                // Set chart options
                var options = {'title':'How Much Pizza I Ate Last Night',
                    'width':400,
                    'height':300};

                // Instantiate and draw our chart, passing in some options.
                //var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
                //chart.draw(data, options);
            }
            
            //Oggetto Logger
            function Logger(msg,obj){
                var logger=$("#iot-logger"),
                currDate=new Date();
                logger.prepend(currDate.toLocaleString()+" - "+msg+" "+obj.toString()+"\n<br>");
                console.log(obj);                                        
            };
            
            /*
             * set a cookie in the browser wiht the given name and value, that lasts for the given number of days
             */
            function setCookie(name,value,exdays)
            {
                var exdate=new Date();
                exdate.setDate(exdate.getDate() + exdays);
                var value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
                document.cookie=name + "=" + value;
            }
            /*
             * try to retrive the value of the cookie with the given name
             */
            function getCookie(name)
            {
                var i,x,y,ARRcookies=document.cookie.split(";");
                for (i=0;i<ARRcookies.length;i++)
                {
                    x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
                    y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
                    x=x.replace(/^\s+|\s+$/g,"");
                    if (x==name)
                    {
                        return unescape(y);
                    }
                }
            }

			
            //On document load load the canvas..
            $(document).ready(function(){
                
                
                //ask for connection
                var scctChannel = new SCCTChannel();
                var iotDash=new iotDashboard(scctChannel);   //create the dashboard with the SCCTChannel
                
                // try to retrive connections parameters from cookies
                if (getCookie('host')){$("#server-host").val(getCookie('host'));}
                if (getCookie('port')){$("#server-port").val(getCookie('port'));}
                if (getCookie('apikey')){$("#server-apikey").val(getCookie('apikey'));}
                if (getCookie('tout')){$("#server-tout").val(getCookie('tout'));}
				
                $('#connectionModal').modal({keyboard: false,backdrop:"static"});
                $('#connectionModal #connect').click(function(e){
                    
                    var host=$("#server-host").val();
                    var port=$("#server-port").val();
                    var apikey=$("#server-apikey").val();
                    var tout=$("#server-tout").val();
					
                    //set connection parameters in cookies
                    setCookie('host',host,7);
                    setCookie('port',port,7);
                    setCookie('apikey',apikey,7);
                    setCookie('tout',tout,7);
					
                    iotDash.connect(host,port,apikey,tout);
                    console.log(iotDash);
                    $('#connectionModal').modal('hide');
                    /*
                    if(scctChannel!=null){
                        scctChannel.connectToPublisher(
                        't4sm.blogdns.com', //IP ADDRESS
                        '8089', //PORT
                        'SCS', //API KEY
                        3600 //TIMEOUT
                    );
                    }
                     */
                });                
                
                $('#startStream').click(function(e){
                    e.preventDefault();                    
                    iotDash.startStream();
                });
                $('#stopStream').click(function(e){
                    e.preventDefault();                    
                    iotDash.stopStream();
                });
            });
        </script>
    </head>
    <body>   
        <div id="connectionModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h3 id="myModalLabel">Connect to server</h3>
            </div>
            <div class="modal-body">
                <form id="connectionForm" class="form-horizontal">
                    <fieldset>
                        <legend>Insert server parameters</legend>
                        <div class="control-group">
                            <label class="control-label">Server IP:</label>
                            <div class="controls">
                                <input id="server-host" type="text" placeholder="localhost">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Server port:</label>
                            <div class="controls">
                                <input id="server-port" type="text" placeholder="3000">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">API key:</label>
                            <div class="controls">
                                <input id="server-apikey" type="text" placeholder="scs">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Timeout:</label>
                            <div class="controls">
                                <input id="server-tout" type="text" placeholder="20.00">
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
            <div class="modal-footer">
                <button id="connect" class="btn btn-primary" data-loading-text="Connecting..." data-toggle="button">Connect</button>
            </div>
        </div>
        <header class="header">               
            <div class="navbar navbar-fixed-top navbar-inverse">
                <div class="navbar-inner">
                    <div class="container-narrow">
                        <a class="brand" href="/index.html" style="padding-top: 6px; padding-bottom: 0px;">
                            <img class="iot-small-logo" src="img/IOT-dashboard-02.jpg" />
                        </a>
                        <ul class="nav">
                            <li class="divider-vertical"></li>
                            <li class="active"><a href="/index.html#home">Home</a></li>
                            <li><a href="/index.html#about">About</a></li>
                            <li><a href="/index.html#contact">Contact</a></li>
                            <li class="divider-vertical"></li>
                        </ul>
                        <a class="btn btn-primary pull-right" href="https://github.com/GDGBrescia/iot-dashboard" target="_blank">
                            <i class="icon-github"></i>
                            Fork on GitHub</a>

                    </div>
                </div>
            </div>
        </header>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span3">
                    <div class="left-sidebar">
                        <div class="span12 well">
                            <h2>Event Logger</h2>
                            <h4>This is the IoT event logger.</h4>
                            <div id="iot-logger"></div>
                        </div>
                    </div>
                    <div class="left-sidebar">
                        <div class="span12 well">   
                            <p><img id="pulse" src="/app/img/red-light.png"></p>
                            <p>Prodotti disponibili: <span id="system_availableProductTypes">0</span></p>
                            <p>Velocità massima motore: <span id="system_maxMotorSpeed">0</span> RPM</p>
                            <div id="system_hw"></div>
                            <hr>
                            <p>
                                <a id="startStream" class="btn btn-primary">Start Stream</a>
                                <a id="stopStream" class="btn btn-warning">Stop Stream</a>
                            </p>
                            <p id="system_conn_parameters"></p>
                        </div>
                    </div><!--/.well -->
                </div><!--/span-->
                <div class="span9">
                    <div class="hero-unit">
                        <h2 id="system_name"></h2>
                        <p id="system_description">Descrizione sistema</p>                        
                    </div>
                    <div id="iot_channels" class="row-fluid">

                    </div>
                </div><!--/span-->
            </div><!--/row-->
            <hr>
            <footer class="footer">
                <p class="muted credit">Powered by GDG Brescia & T4SM</p>
                <p class="muted credit">Code licensed under the
                    <a href="http://www.gnu.org/licenses/gpl-2.0.html" target="_blank">
                        GNU General Public License, version 2</a>.
                    Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
                </p>
            </footer>
        </div>

    </body>
</html>